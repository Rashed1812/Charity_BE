# ูุธุงู ุฑุณุงุฆู ุงูุดูุงูู - Complaint Messaging System

## ๐ ูุธุฑุฉ ุนุงูุฉ ุนูู ูุธุงู ุงูุฑุณุงุฆู

ูุธุงู ุฑุณุงุฆู ุงูุดูุงูู ุงูุญุงูู ูุนูู ุจูุธุงู **ุงูุฑุณุงุฆู ุงููุชุชุงุจุนุฉ (Sequential Messages)** ูููุณ **ุงูุดุงุช ุงููุจุงุดุฑ (Live Chat)**. ุฏุนูู ุฃูุถุญ ุงููุฑู ูุงูุฎูุงุฑุงุช ุงููุชุงุญุฉ.

---

## ๐ ุงููุธุงู ุงูุญุงูู (Sequential Messages)

### ููู ูุนูู ุงููุธุงู ุงูุญุงูู:

#### 1. **ุฅูุดุงุก ุงูุดููู**
```
ุงููุณุชุฎุฏู โ ูุฑุณู ุดููู ุฌุฏูุฏุฉ
ุงููุธุงู โ ูุญูุธ ุงูุดููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
ุงููุธุงู โ ูุฑุณู ุฅุดุนุงุฑ ูููุฏูุฑ
```

#### 2. **ุชุจุงุฏู ุงูุฑุณุงุฆู**
```
ุงููุณุชุฎุฏู โ ูุถูู ุฑุณุงูุฉ ููุดููู
ุงููุธุงู โ ูุญูุธ ุงูุฑุณุงูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
ุงููุธุงู โ ูุฑุณู ุฅุดุนุงุฑ ูููุฏูุฑ
ุงููุฏูุฑ โ ูุฑุฏ ุนูู ุงูุฑุณุงูุฉ
ุงููุธุงู โ ูุญูุธ ุงูุฑุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
ุงููุธุงู โ ูุฑุณู ุฅุดุนุงุฑ ูููุณุชุฎุฏู
```

#### 3. **ูุชุงุจุนุฉ ุงููุญุงุฏุซุฉ**
```
- ูู ุฑุณุงูุฉ ุชุญูุธ ูู ุฌุฏูู ComplaintMessage
- ุงูุฑุณุงุฆู ูุฑุชุจุฉ ุญุณุจ ุงูุชุงุฑูุฎ
- ูููู ุฑุคูุฉ ุฌููุน ุงูุฑุณุงุฆู ูู ุตูุญุฉ ุงูุดููู
- ุงููุธุงู ูุญุฏุฏ ูู ูู ุงููุฑุณู (ูุณุชุฎุฏู ุฃู ูุฏูุฑ)
```

### ูุซุงู ุนูู ุงูุชุฏูู:

```
1. ุงููุณุชุฎุฏู ูุฑุณู ุดููู: "ูุดููุฉ ูู ุชุณุฌูู ุงูุฏุฎูู"
2. ุงููุฏูุฑ ูุฑุฏ: "ุฃููุงูุ ูู ููููู ุชูุถูุญ ุงููุดููุฉ ุฃูุซุฑุ"
3. ุงููุณุชุฎุฏู ูุฑุฏ: "ูุง ุฃุณุชุทูุน ุงูุฏุฎูู ุจุญุณุงุจู"
4. ุงููุฏูุฑ ูุฑุฏ: "ุฌุฑุจ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ"
5. ุงููุณุชุฎุฏู ูุฑุฏ: "ุดูุฑุงูุ ุงููุดููุฉ ุญููุช"
6. ุงููุฏูุฑ ูุบูู ุงูุดููู: "ุชู ุงูุญู ุจูุฌุงุญ"
```

---

## ๐ ุงูุฎูุงุฑุงุช ุงููุชุงุญุฉ ูุชุญุณูู ุงููุธุงู

### 1. **ุงููุธุงู ุงูุญุงูู (Sequential Messages)**
#### โ ุงููููุฒุงุช:
- ุจุณูุท ูุณูู ุงูุชูููุฐ
- ูุญูุธ ุชุงุฑูุฎ ูุงูู ูููุญุงุฏุซุฉ
- ูููู ุงูุฑุฌูุน ููุฑุณุงุฆู ุงูุณุงุจูุฉ
- ูุง ูุญุชุงุฌ ุชูููุงุช ูุนูุฏุฉ

#### โ ุงูุนููุจ:
- ููุณ ูู ุงูููุช ุงููุนูู
- ูุญุชุงุฌ ุชุญุฏูุซ ุงูุตูุญุฉ ูุฑุคูุฉ ุงูุฑุณุงุฆู ุงูุฌุฏูุฏุฉ
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูู ุชูุงุนููุฉ

### 2. **ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงูููุฑูุฉ (Real-time Notifications)**
#### โ ุงููููุฒุงุช:
- ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนูุฏ ูุตูู ุฑุณุงูุฉ ุฌุฏูุฏุฉ
- ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- ูุง ูุญุชุงุฌ ุชุญุฏูุซ ุงูุตูุญุฉ

#### ๐ง ุงูุชูููุฐ:
```csharp
// ุงุณุชุฎุฏุงู SignalR ููุฅุดุนุงุฑุงุช ุงูููุฑูุฉ
public class NotificationHub : Hub
{
    public async Task SendNotification(string userId, string message)
    {
        await Clients.User(userId).SendAsync("ReceiveNotification", message);
    }
}
```

### 3. **ูุธุงู ุงูุดุงุช ุงููุจุงุดุฑ (Live Chat)**
#### โ ุงููููุฒุงุช:
- ูุญุงุฏุซุฉ ูู ุงูููุช ุงููุนูู
- ุฑุคูุฉ "ููุชุจ ุงูุขู..."
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ
- ุณุฑุนุฉ ูู ุงูุชูุงุตู

#### ๐ง ุงูุชูููุฐ:
```csharp
// ุงุณุชุฎุฏุงู SignalR ููุดุงุช ุงููุจุงุดุฑ
public class ChatHub : Hub
{
    public async Task SendMessage(int complaintId, string message, string userId)
    {
        // ุญูุธ ุงูุฑุณุงูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
        await SaveMessageToDatabase(complaintId, message, userId);
        
        // ุฅุฑุณุงู ุงูุฑุณุงูุฉ ูุฌููุน ุงููุชุตููู ุจุงูุดููู
        await Clients.Group($"Complaint_{complaintId}").SendAsync("ReceiveMessage", message, userId);
    }
    
    public async Task JoinComplaintGroup(int complaintId)
    {
        await Groups.AddToGroupAsync(Context.ConnectionId, $"Complaint_{complaintId}");
    }
}
```

### 4. **ูุธุงู ูุฌูู (Hybrid System)**
#### โ ุงููููุฒุงุช:
- ูุฌูุน ุจูู ูููุฒุงุช ุงููุธุงููู
- ูุฑููุฉ ูู ุงูุงุณุชุฎุฏุงู
- ูููู ุงูุชุทููุฑ ุชุฏุฑูุฌูุงู

---

## ๐ง ุงูุชูููุฐ ุงูุชููู

### 1. **ุงููุธุงู ุงูุญุงูู (REST API)**

#### API Endpoints:
```csharp
// ุฅุถุงูุฉ ุฑุณุงูุฉ ุฌุฏูุฏุฉ
POST /api/complaint/{id}/messages
{
    "message": "ูุญุชูู ุงูุฑุณุงูุฉ"
}

// ุนุฑุถ ุฌููุน ุงูุฑุณุงุฆู
GET /api/complaint/{id}/messages
```

#### ูู ุงููุฑููุช ุฅูุฏ:
```javascript
// ุฅุฑุณุงู ุฑุณุงูุฉ
async function sendMessage(complaintId, message) {
    const response = await fetch(`/api/complaint/${complaintId}/messages`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message })
    });
    return response.json();
}

// ุนุฑุถ ุงูุฑุณุงุฆู
async function loadMessages(complaintId) {
    const response = await fetch(`/api/complaint/${complaintId}/messages`);
    const messages = await response.json();
    displayMessages(messages);
}
```

### 2. **ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงูููุฑูุฉ (SignalR)**

#### ุฅุนุฏุงุฏ SignalR:
```csharp
// Program.cs
builder.Services.AddSignalR();

app.MapHub<NotificationHub>("/notificationHub");
```

#### Hub ููุฅุดุนุงุฑุงุช:
```csharp
public class NotificationHub : Hub
{
    public async Task JoinUserGroup(string userId)
    {
        await Groups.AddToGroupAsync(Context.ConnectionId, $"User_{userId}");
    }
    
    public async Task SendComplaintNotification(string userId, string complaintId, string message)
    {
        await Clients.Group($"User_{userId}").SendAsync("NewComplaintMessage", complaintId, message);
    }
}
```

#### ูู ุงููุฑููุช ุฅูุฏ:
```javascript
// ุงูุงุชุตุงู ุจู SignalR
const connection = new signalR.HubConnectionBuilder()
    .withUrl("/notificationHub")
    .build();

// ุงูุงุณุชูุงุน ููุฅุดุนุงุฑุงุช
connection.on("NewComplaintMessage", (complaintId, message) => {
    showNotification(`ุฑุณุงูุฉ ุฌุฏูุฏุฉ ูู ุงูุดููู ${complaintId}`);
    if (currentComplaintId === complaintId) {
        loadMessages(complaintId);
    }
});

connection.start();
```

### 3. **ูุธุงู ุงูุดุงุช ุงููุจุงุดุฑ (Live Chat)**

#### Hub ููุดุงุช:
```csharp
public class ChatHub : Hub
{
    public async Task JoinComplaintChat(int complaintId)
    {
        await Groups.AddToGroupAsync(Context.ConnectionId, $"Complaint_{complaintId}");
    }
    
    public async Task SendMessage(int complaintId, string message, string userId, bool isAdmin)
    {
        // ุญูุธ ุงูุฑุณุงูุฉ
        var complaintMessage = new ComplaintMessage
        {
            ComplaintId = complaintId,
            UserId = userId,
            Message = message,
            IsAdmin = isAdmin,
            CreatedAt = DateTime.UtcNow
        };
        
        await _complaintMessageRepository.AddAsync(complaintMessage);
        
        // ุฅุฑุณุงู ุงูุฑุณุงูุฉ ููุฌููุน
        await Clients.Group($"Complaint_{complaintId}").SendAsync("ReceiveMessage", {
            id: complaintMessage.Id,
            message: message,
            userId: userId,
            isAdmin: isAdmin,
            createdAt: complaintMessage.CreatedAt
        });
    }
    
    public async Task Typing(int complaintId, string userId)
    {
        await Clients.Group($"Complaint_{complaintId}").SendAsync("UserTyping", userId);
    }
}
```

#### ูู ุงููุฑููุช ุฅูุฏ:
```javascript
// ุงูุงุชุตุงู ุจุงูุดุงุช
const chatConnection = new signalR.HubConnectionBuilder()
    .withUrl("/chatHub")
    .build();

// ุงูุงูุถูุงู ูุดุงุช ุงูุดููู
async function joinComplaintChat(complaintId) {
    await chatConnection.invoke("JoinComplaintChat", complaintId);
}

// ุฅุฑุณุงู ุฑุณุงูุฉ
async function sendChatMessage(complaintId, message) {
    await chatConnection.invoke("SendMessage", complaintId, message, currentUserId, isAdmin);
}

// ุงุณุชูุจุงู ุฑุณุงูุฉ
chatConnection.on("ReceiveMessage", (messageData) => {
    displayMessage(messageData);
});

// ุฑุคูุฉ "ููุชุจ ุงูุขู..."
chatConnection.on("UserTyping", (userId) => {
    showTypingIndicator(userId);
});
```

---

## ๐ฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงูููุชุฑุญุฉ

### 1. **ุตูุญุฉ ุงูุดููู ูุน ุงูุฑุณุงุฆู**

```html
<div class="complaint-details">
    <!-- ุชูุงุตูู ุงูุดููู -->
    <div class="complaint-header">
        <h3>ูุดููุฉ ูู ุชุณุฌูู ุงูุฏุฎูู</h3>
        <span class="status pending">ูุนูู</span>
    </div>
    
    <!-- ููุทูุฉ ุงูุฑุณุงุฆู -->
    <div class="messages-container">
        <div class="message user-message">
            <div class="message-content">
                ูุง ุฃุณุชุทูุน ุชุณุฌูู ุงูุฏุฎูู ูุญุณุงุจู
            </div>
            <div class="message-time">10:30 ุต</div>
        </div>
        
        <div class="message admin-message">
            <div class="message-content">
                ุฃููุงูุ ูู ููููู ุชูุถูุญ ุงููุดููุฉ ุฃูุซุฑุ
            </div>
            <div class="message-time">10:35 ุต</div>
        </div>
    </div>
    
    <!-- ูููุฐุฌ ุฅุฑุณุงู ุฑุณุงูุฉ -->
    <div class="message-form">
        <textarea placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..."></textarea>
        <button onclick="sendMessage()">ุฅุฑุณุงู</button>
    </div>
</div>
```

### 2. **ุฅุดุนุงุฑุงุช ููุฑูุฉ**

```javascript
// ุฅุดุนุงุฑ ุนูุฏ ูุตูู ุฑุณุงูุฉ ุฌุฏูุฏุฉ
function showNotification(title, body) {
    if (Notification.permission === "granted") {
        new Notification(title, { body });
    }
}

// ุชุญุฏูุซ ุนุฏุงุฏ ุงูุฑุณุงุฆู
function updateMessageCount(complaintId) {
    const badge = document.querySelector(`[data-complaint="${complaintId}"] .badge`);
    const currentCount = parseInt(badge.textContent) || 0;
    badge.textContent = currentCount + 1;
}
```

---

## ๐ฏ ุงูุชูุตูุงุช

### 1. **ููุจุฏุงูุฉ (MVP)**
- ุงุณุชุฎุฏู ุงููุธุงู ุงูุญุงูู (Sequential Messages)
- ุฃุถู ุฅุดุนุงุฑุงุช ููุฑูุฉ ุจุงุณุชุฎุฏุงู SignalR
- ุฑูุฒ ุนูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุงูุฃุณุงุณูุฉ

### 2. **ููุชุญุณูู (Enhancement)**
- ุฃุถู ูุธุงู "ููุชุจ ุงูุขู..."
- ุญุณูู ูุงุฌูุฉ ุงููุณุชุฎุฏู
- ุฃุถู ุฅููุงููุฉ ุฅุฑูุงู ูููุงุช

### 3. **ูููุณุชูุจู (Advanced)**
- ูุธุงู ุดุงุช ูุจุงุดุฑ ูุงูู
- ุฏุนู ุงูุตูุช ูุงูููุฏูู
- ุฐูุงุก ุงุตุทูุงุนู ูููุณุงุนุฏุฉ

---

## ๐ ููุงุฑูุฉ ุงูุฎูุงุฑุงุช

| ุงูููุฒุฉ | ุงููุธุงู ุงูุญุงูู | ุฅุดุนุงุฑุงุช ููุฑูุฉ | ุดุงุช ูุจุงุดุฑ |
|--------|---------------|----------------|-----------|
| ุณูููุฉ ุงูุชูููุฐ | โญโญโญโญโญ | โญโญโญโญ | โญโญ |
| ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู | โญโญโญ | โญโญโญโญ | โญโญโญโญโญ |
| ุงูุฃุฏุงุก | โญโญโญโญโญ | โญโญโญโญ | โญโญโญ |
| ุงูุชูููุฉ | ููุฎูุถุฉ | ูุชูุณุทุฉ | ุนุงููุฉ |
| ุงูุตูุงูุฉ | ุณููุฉ | ูุชูุณุทุฉ | ูุนูุฏุฉ |

---

## ๐ ุงูุฎูุงุตุฉ

### **ุงููุธุงู ุงูุญุงูู ุฌูุฏ ููุจุฏุงูุฉ:**
- โ ุณูู ุงูุชูููุฐ ูุงูุตูุงูุฉ
- โ ูุญูุธ ุชุงุฑูุฎ ูุงูู ูููุญุงุฏุซุงุช
- โ ููุงุณุจ ูููุดุงุฑูุน ุงูุตุบูุฑุฉ ูุงููุชูุณุทุฉ

### **ูููู ุงูุชุทููุฑ ุชุฏุฑูุฌูุงู:**
1. **ุงููุฑุญูุฉ ุงูุฃููู**: ุงููุธุงู ุงูุญุงูู + ุฅุดุนุงุฑุงุช ููุฑูุฉ
2. **ุงููุฑุญูุฉ ุงูุซุงููุฉ**: ุชุญุณูู ูุงุฌูุฉ ุงููุณุชุฎุฏู
3. **ุงููุฑุญูุฉ ุงูุซุงูุซุฉ**: ุดุงุช ูุจุงุดุฑ ูุงูู

### **ุงูุชูุตูุฉ ุงูููุงุฆูุฉ:**
ุงุจุฏุฃ ุจุงููุธุงู ุงูุญุงูู ูุน ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ููุฑูุฉุ ุซู ุทูุฑ ุงููุธุงู ุชุฏุฑูุฌูุงู ุญุณุจ ุงุญุชูุงุฌุงุช ุงููุณุชุฎุฏููู! ๐ฏ

---

*ุชู ุงูุชุญููู ุจุชุงุฑูุฎ: ุฏูุณูุจุฑ 2024* 